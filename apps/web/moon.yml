language: typescript
stack: frontend
layer: application

fileGroups:
  sources:
    - 'src/**/*'
  configs:
    - 'tsconfig.json'
    - 'package.json'

dependsOn:
  - types

tasks:
  dev:
    command: 'bunx --bun vite'
    preset: server
    options:
      envFile: '/.env'

  build:
    command: 'bunx --bun vite build'
    inputs:
      - '@group(sources)'
      - '@group(configs)'
      - 'index.html'
      - 'vite.config.ts'
    outputs:
      - 'dist'
    options:
      envFile: '/.env'

  preview:
    command: 'bunx --bun vite preview'
    preset: server
    options:
      envFile: '/.env'

  format:
    command: 'bun run format'
    inputs:
      - '@group(sources)'
      - '@group(configs)'

  format-check:
    command: 'bun run format:check'
    inputs:
      - '@group(sources)'
      - '@group(configs)'

  test:
    command: 'bun run test'
    inputs:
      - '@group(sources)'
      - '@group(configs)'

  coverage:
    command: 'bun run coverage'
    inputs:
      - '@group(sources)'
      - '@group(configs)'
    outputs:
      - 'coverage'

  quality:
    command: 'echo "web quality checks passed"'
    deps:
      - 'format-check'
      - 'lint'
      - 'typecheck'
      - 'test'
